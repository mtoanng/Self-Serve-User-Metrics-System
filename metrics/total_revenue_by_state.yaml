metric_name: total_revenue_by_state
description: Total revenue (price + freight) generated by each state
owner: data.analyst@shopback.com
schedule: "0 9 * * 1"
sql: |
  SELECT 
      c.customer_state,
      SUM(oi.price + oi.freight_value) AS total_revenue
  FROM orders o
  JOIN customers c ON o.customer_id = c.customer_id
  JOIN order_items oi ON o.order_id = oi.order_id
  GROUP BY 1
